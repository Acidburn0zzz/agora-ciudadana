{% extends "base.html" %}
{% load i18n %}
{% load endless %}
{% load agora_utils %}

{% block content-wrapper-class %}home{% endblock %}

{% block content %}
        <div class="row election-content-row">
            <div id="activity_item_list">
                {% for action in activity %}
                    {% include "agora_core/action_item.html" %}
                {% endfor %}
            </div>
            <div class="content">
                <div id="activity_items">
                <!-- here will appear the activity items stream -->
                </div>
                <div id="activity_fadeout">
                </div>
            </div>
            <div class="sidebar">
                <div class="row-fluid">
                    <canvas id="home_worldmap_canvas">
                        <img id="home_worldmap" src="{{STATIC_URL }}img/home_worldmap_mercator.png" />
                    </canvas>
                </div>
            </div>
            <script type="text/javascript">
                jQuery(document).ready(function() {
                    var currentSlide = 0; // keeps track of current slide
                    var slides = $('#activity_item_list > div'); // this is the original list of slides
                    var slideShowElement = '#activity_items'; // this is where the infinite news scroll will be shown
                    var interval = setInterval(nextSlide, DELAY_SPEED); // used for setInerval
                    var DELAY_SPEED = 4000; // specifies how much time between new items appear

                    // init
                    slides.each(function() {
                        $(this).appendTo($(slideShowElement));
                    });

                    // Goes to the next slide
                    function nextSlide () {
                        //if the current slide is at the end, loop to the first slide.
                        if (currentSlide >= slides.length -1) {
                            currentSlide = 0;
                        } else {
                            currentSlide++;
                        }

                        // Add a new slide

                        $(slideShowElement + ' > div').first().removeClass('activity-action-first');

                        var newElement = $(slides[currentSlide]).clone().addClass('activity-action-first').hide();

                        newElement.prependTo($(slideShowElement));
                        newElement.animate({"height": "toggle", "opacity": "toggle"}, "slow");
                        $(slideShowElement + ' > div').last().remove();

                        //if the auto slide advance is set, stop it, then start again.
                        if (interval != null) {
                            clearInterval(interval);
                        }
                        //Goes to next slide every couple of seconds.
                        interval = setInterval(nextSlide, DELAY_SPEED);
                    }

                    var canvasSelector = '#home_worldmap_canvas';

                    // X and Y boundaries
                    var westLong = -172;
                    var eastLong = 179.578857;
                    var northLat = 100;
                    var southLat = -55.801281;


                    var img = new Image();
                    img.src = "{{STATIC_URL }}img/home_worldmap_mercator.png";
                    img.onload = function() {
                        var ctx = document.getElementById('home_worldmap_canvas').getContext('2d'); 
                        ctx.drawImage(img, 0, 0, 321, 166);
                        drawPoint(40.413496,-3.739014);
                        drawPoint(7.885147, 81.020506);
                        drawPoint(-42.163403,146.674803);
                    }

                    function drawPoint(latitude, longitude)
                    {
                        var x = $(canvasSelector).width() * ((westLong - longitude) / (westLong - eastLong));
                        var y = $(canvasSelector).height() * ((northLat - latitude) / (northLat - southLat));
                        var ctx = document.getElementById('home_worldmap_canvas').getContext('2d'); 
                        console.log("x = " + x + ", y = " + y);
                        ctx.fillStyle = "red";
                        ctx.fillRect(x, y, 2, 2);
                    }

                });
            </script>
        </div>
{% endblock %}
