{% extends 'agora_core/agora_view.html' %}
{% load i18n %}
{% load endless %}
{% load agora_utils %}

{% block title %}{% trans "Members" %} - {{ agora.creator.username }}/{{ agora.name }}{% endblock %}

{% block agora-navigation %}{% activetab "agora-nav" "members" %}{{ block.super }}{% endblock %}

{% block content %}
    <div class="row">
        <div class="span8 agora-left-side">
            <div class="activity-list" id="user-list"
                data-url="/api/v1/agora/{{ agora.id }}/{{filter}}/"
                data-agora-path="{{ agora.get_link }}"
                data-agora-id="{{ agora.id }}" data-method="get" data-margin="300">

                <div class="endless-container">
                    <a class="endless_more" href="#">{% trans "more" %}</a>
                    <div class="endless_loading hidden">{% trans "Loading..." %}</div>
                </div>
            </div>
        </div>
        <div class="span4 agora-right-side">
            {% if agora|is_agora_admin:user %}
	    <!--<a class="btn btn-large btn-block bottom-space" href="{ % url agora-add-members agora.creator.username agora.name %}">-->
            <a id="manual-member" class="btn btn-primary btn-block btn-large">{% trans "Add members manually" %}</a>
            </a>
            {% endif %}
            <ul class="nav nav-pills nav-stacked">
                <li{% ifequal filter 'members' %} class="active"{% endifequal %}>
                    <a href="{% url agora-members agora.creator.username agora.name 'members' %}">
                        {% trans "Members" %} ({{ agora.members.count }})
                    </a>
                </li>
                <li{% ifequal filter 'admins' %} class="active"{% endifequal %}>
                    <a href="{% url agora-members agora.creator.username agora.name 'admins' %}">
                        {% trans "Admins" %} ({{ agora.admins.count }})
                    </a>
                </li>
                <li{% ifequal filter 'active_delegates' %} class="active"{% endifequal %}>
                    <a href="{% url agora-members agora.creator.username agora.name 'active_delegates' %}">
                        {% trans "Delegates" %} ({{ agora.active_delegates.count }})
                    </a>
                </li>
                {% if agora|is_agora_admin:user %}
                    <li{% ifequal filter 'membership_requests' %} class="active"{% endifequal %}>
                        <a href="{% url agora-members agora.creator.username agora.name 'membership_requests' %}">
                            {% trans "Requested membership" %} ({{ agora.users_who_requested_membership.count }})
                        </a>
                    </li>
                    <li{% ifequal filter 'admin_membership_requests' %} class="active"{% endifequal %}>
                        <a href="{% url agora-members agora.creator.username agora.name 'admin_membership_requests' %}">
                            {% trans "Requested admin membership" %} ({{ agora.users_who_requested_admin_membership.count }})
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}


{% block script-block %}
    <script>
    var ajax_data = {
        'agora': {% rest request '/agora/' agora.id %},
    };
    </script>


    {% include "search/include-js-template-agora-profile.html" %}
    <script>app.currentView = new Agora.AgoraUserListView(); </script>

    {% include "agora_core/client/modal_dialog.html" %}
    <div class="modal-foot hide">
         <a href="#" class="btn btn-primary">{% trans "Add members" %}</a>
    </div>
    <div class="modal-body hide">
        <p>
        {% blocktrans %}
        Add members emails to invite separated by commas. If the
        user exists in agora will be added directly, if not an email with
        an invitation will be sent.
        {% endblocktrans %}
        </p>
        <textarea placeholder="user1@example.com, user2@example.com" class="input-block-level"></textarea>
    </div>
    <script type="text/javascript">
        app.addMembersDialog = new Agora.ModalDialogView();
        title = gettext('Add members manually');
        body = $(".modal-body").html();
        footer = $(".modal-foot").html();

        app.addMembersDialog.populate(title, body, footer);
        $("#manual-member").click(function() {
            app.addMembersDialog.show();
            return false;
        });
    </script>

{% endblock %}
